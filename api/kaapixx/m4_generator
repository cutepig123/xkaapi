#!/bin/sh
#
## KAAPI library source
## -----------------------------------------
##
## by Thierry Gautier. Based on idea of M. Doreille
## Apache Project, IMAG, Grenoble, France
##
## use:
#  m4_generator <NB_PARAM> 
#


makeheader() {
cat <<ENDDDD 
/* KAAPI/Kaapi++ public interface */
// KAAPI library source
// -----------------------------------------
// by Thierry Gautier
//(c) INRIA, projet MOAIS, 2006-2010
//
// **********************************************************
// WARNING! This file has been automatically generated by M4
// `date`
// *********************************************************
ENDDDD

}



#############################################################
## loop for file bodies
#############################################################

NUMBER=0
COUNTER=$1
MAX_NUMBER_PARAMS=$1
## `expr $1 + 1`

makeheader > ka_api_clo.h
makeheader > ka_api_spawn.h
makeheader > ka_api_execgraph.h
makeheader > ka_api_execforeach.h

while [ $COUNTER -ge 0 ]
do
      m4 -DKAAPI_NUMBER_PARAMS=$NUMBER -DKAAPI_MAX_NUMBER_PARAMS=$MAX_NUMBER_PARAMS m4_macros  ka_api_clo.m4 >> ka_api_clo.h
      if [ $NUMBER -gt 0 ]
      then
        m4 -DKAAPI_NUMBER_PARAMS=$NUMBER -DKAAPI_MAX_NUMBER_PARAMS=$MAX_NUMBER_PARAMS m4_macros  ka_api_spawn.m4 >> ka_api_spawn.h
        m4 -DKAAPI_NUMBER_PARAMS=$NUMBER -DKAAPI_MAX_NUMBER_PARAMS=$MAX_NUMBER_PARAMS m4_macros  ka_api_execgraph.m4 >> ka_api_execgraph.h
        m4 -DKAAPI_NUMBER_PARAMS=$NUMBER -DKAAPI_MAX_NUMBER_PARAMS=$MAX_NUMBER_PARAMS m4_macros  ka_api_execforeach.m4 >> ka_api_execforeach.h
      fi
      echo "Generating file: $file step $NUMBER :-)"
      NUMBER=`expr $NUMBER + 1`
      COUNTER=`expr $COUNTER - 1`
done


