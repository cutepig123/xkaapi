<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Kaapi: Passing options to a KAAPI process</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="KAAPI_EX_2">Passing options to a KAAPI process </a></h1><p>This example shows how to pass options to KAAPI process using file or command line arguments. The idea is to define Module object with options that allows to automatically generate the parser from command line arguments or file. This Module definition is used internally to define runtime options for KAAPI middleware.</p>
<h2><a class="anchor" id="KAAPI_COMPIL_2">
Compilation</a></h2>
<p>This example illustrates how a program on top of KAAPI could defined its own options that can be parsed from command line argument. The example comes from the Athapascan API on top of KAAPI. Simply enter in your build directory examples: </p>
<div class="fragment"><pre class="fragment">      &gt; make cmdline1
</pre></div><h2><a class="anchor" id="KAPPI_RUN_2">
Running</a></h2>
<p>After compiling it, runing the example with following option </p>
<div class="fragment"><pre class="fragment">      &gt; ./cmdline1  -- mynet --a1 -this_is_not_an_a1_option 3  --a1  -thread.poolsize 5 \
      -sti.scotch.flag 1  --badoption  --a1 -sti.costmodel azerty
</pre></div><p> produces the following output </p>
<div class="fragment"><pre class="fragment">      Usage:Usage <span class="keywordflow">for</span> module <span class="stringliteral">&#39;a1&#39;</span>
 sti.costmodel
              Command line : -sti.costmodel
              Resource name: a1.sti.costmodel
              Default value: uetc
              Usage        : Cost model <span class="keywordflow">for</span> taking into cost information: uetc/user
 sti.scotch.flag
              Command line : -sti.scotch.flag
              Resource name: a1.sti.scotch.flag
              Default value: 
              Usage        : Default heuristic flag <span class="keywordflow">for</span> Scotch algorithm
 thread.poolsize
              Command line : -thread.poolsize
              Resource name: a1.thread.poolsize
              Default value: 1
              Usage        : This option is to setup the number of K-<a class="code" href="dscglobal_8h.html#a4a304b3c13983e6983952c83a8d99266">processor</a>
 verbose
              Command line : -verbose
              Resource name: a1.verbose
              Default value: <span class="keyword">false</span>
              Usage        : <span class="keyword">true</span> iff verbose mode is activated

      New command line=./cmdline1 -- mynet -this_is_not_an_a1_option 3 --badoption 
      Properties <span class="keywordflow">for</span> <span class="stringliteral">&#39;a1&#39;</span>: 
      a1.sti.costmodel=azerty;
      a1.sti.scotch.flag=1;
      a1.thread.poolsize=5;
      a1.verbose=<span class="keyword">false</span>;
</pre></div><p>Any module with name 'modulename' and option with name 'optionname' will produce a parser that recognize the command line options: --&lt;modulename&gt; -&lt;optionname&gt; [value]. Then the key 'modulename.optionname=[value]' will be added into the properties object where to store result of the parsing.</p>
<h2><a class="anchor" id="KAAPI_SRC_2">
Sources</a></h2>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ==========================================================================</span>
<a name="l00002"></a>00002 <span class="comment">// (c) INRIA, projet MOAIS, 2006</span>
<a name="l00003"></a>00003 <span class="comment">// see the copyright file for more information</span>
<a name="l00004"></a>00004 <span class="comment">// Author: T. Gautier</span>
<a name="l00005"></a>00005 <span class="comment">// - This example shows how to define a parser for command line</span>
<a name="l00006"></a>00006 <span class="comment">// and how to use it to recover properties.</span>
<a name="l00007"></a>00007 <span class="comment">// ==========================================================================</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;kaapi_utils&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="comment">/* Main of the program:</span>
<a name="l00012"></a>00012 <span class="comment">   &gt; ./cmdline1 -- mynet --a1 -this_is_not_an_a1_option 3  --a1  -thread.poolsize 5</span>
<a name="l00013"></a>00013 <span class="comment">    New command line=./cmdline -- mynet </span>
<a name="l00014"></a>00014 <span class="comment">    Options for &#39;a1: </span>
<a name="l00015"></a>00015 <span class="comment">    a1.bindurl=socknet:22.134:5001;</span>
<a name="l00016"></a>00016 <span class="comment">    a1.nthreads=1;</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 <span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])
<a name="l00020"></a>00020 {
<a name="l00021"></a>00021   <span class="keywordflow">try</span> {
<a name="l00022"></a>00022     <span class="comment">/* Begining of using Util library</span>
<a name="l00023"></a>00023 <span class="comment">    */</span>
<a name="l00024"></a>00024     <a class="code" href="class_util_1_1_init.html#ad14c4d3472c07e4d403f7434043afdcd">Util::Init::component</a>.is_required_by();
<a name="l00025"></a>00025     <a class="code" href="class_util_1_1_kaapi_component_manager.html#a1a801d9ed71dae818d0ff3bc339d1750">Util::KaapiComponentManager::initialize</a>( argc, argv );
<a name="l00026"></a>00026     
<a name="l00027"></a>00027     <span class="comment">/* defined a sub set of the options for Athapascan */</span>
<a name="l00028"></a>00028     <a class="code" href="class_util_1_1_properties.html" title="Properties classProperties class allows to store as string parameters such as &amp;#39;key&amp;#39;...">Util::Properties</a> prop;
<a name="l00029"></a>00029     <a class="code" href="class_util_1_1_parser.html">Util::Parser</a> a1_parser;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031     <span class="comment">/* add a new module for the parser */</span>
<a name="l00032"></a>00032     <a class="code" href="class_util_1_1_parser_1_1_module.html">Util::Parser::Module</a> a1_module(<span class="stringliteral">&quot;a1&quot;</span>);
<a name="l00033"></a>00033     <span class="comment">/* add a new option -thread.poolsize with default value 1 */</span>
<a name="l00034"></a>00034     a1_module.add_option(<span class="stringliteral">&quot;thread.poolsize&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;This option is to setup the number of K-processor&quot;</span>);
<a name="l00035"></a>00035     <span class="comment">/* add a new option -verbose with default value to false */</span>
<a name="l00036"></a>00036     a1_module.add_option(<span class="stringliteral">&quot;verbose&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, <span class="stringliteral">&quot;true iff verbose mode is activated&quot;</span>);
<a name="l00037"></a>00037     <span class="comment">/* add a new option -sti.costmodel with default value to uetc */</span>
<a name="l00038"></a>00038     a1_module.add_option(<span class="stringliteral">&quot;sti.costmodel&quot;</span>, <span class="stringliteral">&quot;uetc&quot;</span>, <span class="stringliteral">&quot;Cost model for taking into cost information: uetc/user&quot;</span>);
<a name="l00039"></a>00039     <span class="comment">/* add a new option -sti.scotch.flag without default value, insertion mode= &#39;a&#39;, separator &#39;,&#39; */</span>
<a name="l00040"></a>00040     a1_module.add_option(<span class="stringliteral">&quot;sti.scotch.flag&quot;</span>, <span class="stringliteral">&quot;&lt;no value&gt;&quot;</span>, <span class="stringliteral">&quot;Default heuristic flag for Scotch algorithm&quot;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="comment">/* add a new option -list without default value, insertion mode= &#39;a&#39;, separator &#39; &#39; */</span>
<a name="l00043"></a>00043     a1_module.add_option(<span class="stringliteral">&quot;list&quot;</span>, <span class="stringliteral">&quot;&lt;no value&gt;&quot;</span>, <span class="stringliteral">&quot;This is a list&quot;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="stringliteral">&quot; &quot;</span>);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="comment">/* Ok print the usage for this module */</span>
<a name="l00046"></a>00046     a1_module.print_usage( std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> );
<a name="l00047"></a>00047     std::cout &lt;&lt; std::endl;
<a name="l00048"></a>00048     
<a name="l00049"></a>00049     <span class="comment">/* Initialize a parser with options defined by the module a1_module.</span>
<a name="l00050"></a>00050 <span class="comment">       The recognized options for module &#39;a1&#39; will be stored into properties object &#39;prop&#39;. </span>
<a name="l00051"></a>00051 <span class="comment">    */</span>
<a name="l00052"></a>00052     a1_parser.<a class="code" href="class_util_1_1_parser.html#a0b12bb1f550e0cff48c60895065d0a98">add_module</a>( &amp;a1_module, &amp;prop );
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="comment">/* Parse the command line arguments.</span>
<a name="l00055"></a>00055 <span class="comment">       Recognized options are suppressed from the command line and a new command line</span>
<a name="l00056"></a>00056 <span class="comment">       arguments without them are available using &#39;new_argc()&#39; and  &#39;new_argv()&#39;. </span>
<a name="l00057"></a>00057 <span class="comment">       Other options remain unchanged.</span>
<a name="l00058"></a>00058 <span class="comment">    */</span>
<a name="l00059"></a>00059     a1_parser.<a class="code" href="class_util_1_1_parser.html#a3e64b4d1ca0402e69108d4fea24d062a">parse</a>( prop, argc, argv );
<a name="l00060"></a>00060 
<a name="l00061"></a>00061     <span class="comment">/* Display resulting command line</span>
<a name="l00062"></a>00062 <span class="comment">    */</span>
<a name="l00063"></a>00063     std::cout &lt;&lt; <span class="stringliteral">&quot;New command line=&quot;</span>;
<a name="l00064"></a>00064     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; argc; ++i)
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066       std::cout &lt;&lt; argv[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00067"></a>00067     }
<a name="l00068"></a>00068     std::cout &lt;&lt; std::endl;
<a name="l00069"></a>00069 <span class="comment">/*</span>
<a name="l00070"></a>00070 <span class="comment">    std::cout &lt;&lt; &quot;Old command line=&quot;;</span>
<a name="l00071"></a>00071 <span class="comment">    for (int i=0; i &lt; argc; ++i)</span>
<a name="l00072"></a>00072 <span class="comment">    {</span>
<a name="l00073"></a>00073 <span class="comment">      std::cout &lt;&lt; argv[i] &lt;&lt; &quot; &quot;;</span>
<a name="l00074"></a>00074 <span class="comment">    }</span>
<a name="l00075"></a>00075 <span class="comment">    std::cout &lt;&lt; std::endl;</span>
<a name="l00076"></a>00076 <span class="comment">*/</span>    
<a name="l00077"></a>00077     <span class="comment">/* Display parsed properties </span>
<a name="l00078"></a>00078 <span class="comment">    */</span>
<a name="l00079"></a>00079     std::cout &lt;&lt; <span class="stringliteral">&quot;Properties for &#39;a1&#39;: &quot;</span> &lt;&lt; std::endl;
<a name="l00080"></a>00080     prop.<a class="code" href="class_util_1_1_properties.html#a293128cefd1bba2c94796abc4e48b721">print</a>( std::cout );
<a name="l00081"></a>00081     std::cout &lt;&lt; std::endl;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="comment">/* Display specific property </span>
<a name="l00084"></a>00084 <span class="comment">    */</span>
<a name="l00085"></a>00085     std::cout &lt;&lt; <span class="stringliteral">&quot;Property &#39;a1.sti.scotch.list&#39;=&#39;&quot;</span> &lt;&lt; prop[<span class="stringliteral">&quot;a1.sti.scotch.list&quot;</span>] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; std::endl;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="comment">/* End of using Util library</span>
<a name="l00088"></a>00088 <span class="comment">    */</span>
<a name="l00089"></a>00089     <a class="code" href="class_util_1_1_kaapi_component_manager.html#ab159213cca300a957b1190919c2424a2">Util::KaapiComponentManager::terminate</a>();
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="keywordflow">return</span> 0;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   } <span class="keywordflow">catch</span> (<a class="code" href="class_util_1_1_runtime_error.html">Util::RuntimeError</a>&amp; ex) {
<a name="l00094"></a>00094     std::cerr &lt;&lt; <span class="stringliteral">&quot;Catch exception: &quot;</span> &lt;&lt; ex.<a class="code" href="class_util_1_1_runtime_error.html#a8731908f004cf9a0364d77eecad6cb95">what</a>() &lt;&lt; std::endl;
<a name="l00095"></a>00095   } <span class="keywordflow">catch</span> (...) {
<a name="l00096"></a>00096     std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception&quot;</span> &lt;&lt; std::endl;
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098   <span class="keywordflow">return</span> -1;
<a name="l00099"></a>00099 }
</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 16 08:51:57 2010 for Kaapi by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
