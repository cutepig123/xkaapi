<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Kaapi: Using fault tolerance with KAAPI program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="KAAPI_FT">Using fault tolerance with KAAPI program </a></h1><p>KAAPI provides protocols for managing failures. The model implemented by KAAPI is the fail-stop model: a failed process of a program is considered as stoped and never recontact the rest of the application' processes. This page presents an overview of the usage of Fault Tolerance (<a class="el" href="namespace_f_t.html" title="Basic classes to manage failure.">FT</a>) features for your application in KAAPI.</p>
<h2><a class="anchor" id="KAAPI_FT_KEY">
Key Concepts</a></h2>
<p>The <a class="el" href="namespace_f_t.html" title="Basic classes to manage failure.">FT</a> protocols are based on the dynamic data flow graph unfold during the execution of KAAPI program. It does not require any modification at the source level, except for some application that deals with some global variable that are not referenced in the data flow graph.</p>
<p>When a process has a failure, a special process, called the kaapiserver, detect the failure and take decision about restarting or not the process. The action may be automatically invoked using script or may be taken by the user using command line. The terminaison of the program is done when all tasks are executed, thus in case of failure if some tasks are not restarted then the program will wait for their execution. This could introduce some activity in due to the workstealing algorithm.</p>
<h2><a class="anchor" id="KAAPI_FT_CONFIG">
Configuration</a></h2>
<p>The whole application must be launched using the karun command with the -checkpoint command line option. This option launch the kaapiserver of the local machine that execute the karun command. The other processes of the application will be launched on the machines given as parameter of the karun command.</p>
<p>Most of the configuration process should ensure that:</p>
<ul>
<li>the kaapiserver and application process may communicate through TCP/IP using <a class="el" href="namespace_s_o_c_k_n_e_t.html">SOCKNET</a> network</li>
<li>communication port and binding address may be specify using the 'nameserver' options in kaapi.rc. Please take a look at the output generated by 'kaapiserver --help', especially for the option 'nameserver.bindurl'.</li>
<li>options for controlling the <a class="el" href="namespace_f_t.html" title="Basic classes to manage failure.">FT</a> protocol and restart of process. Currently only the TIC protocol is supported in KAAPI. Thus no protocol selection is available, this feature may changed in new release of the library. The restart mode is controlled by 'community.restart.action', that could be:<ul>
<li>'script': a script with be called by the kaapiserver to restart a failed process, see below.</li>
<li>'alive': an alive process is elected to restart the context of a failed process.</li>
</ul>
</li>
</ul>
<dl class="see"><dt><b>See also:</b></dt><dd>karun, kaapiserver</dd></dl>
<h2><a class="anchor" id="KAAPI_FT_RUN">
Running example</a></h2>
<p>Compile your application as a standard KAAPI application without taking care of the <a class="el" href="namespace_f_t.html" title="Basic classes to manage failure.">FT</a> purpose. Then run it using: </p>
<div class="fragment"><pre class="fragment">  &gt; karun -<a class="code" href="dscglobal_8h.html#a928495140935d9d6ce0a100550473140">np</a> 2 -f hostfile -checkpoint your_prog your_args
</pre></div><p> This command activate the default <a class="el" href="namespace_f_t.html" title="Basic classes to manage failure.">FT</a> protocol in KAAPI allowing your process to be restarted in case of failure.</p>
<h2><a class="anchor" id="KAAPI_FT_RESTART">
Restarting faulty process</a></h2>
<p>In case of failure, the kaapiserver inform the user that a process has failed. When such a message is received the kaapiserver display on the terminal that a specify globalid should be restarted, and if some script are installed, then it call them. The script is specify by the option 'nameserver.restartjob.command' and 'nameserver.restartjob.workdir' the script is invoked with parameters:</p>
<ul>
<li>argv[1] is the program name to restart</li>
<li>argv[2-*] are the additional option for restarting the process. Typically, these options contain '--community -restart true -gid2restart &lt;failed_gid&gt;' which is used by the runtime to restart the process '&lt;failed_gid&gt;' The purpose of the script is to launch a new process withing the options passed as command line argument.</li>
</ul>
<dl class="see"><dt><b>See also:</b></dt><dd>kaapiserver, kaapiadmin</dd></dl>
<h2><a class="anchor" id="KAAPI_FT_OAR">
Integration with OAR batch scheduler</a></h2>
<p>The kaapiserver with script may be used to re-scheduling a job to the OAR batch scheduler. An interessting feature is to used script to execute program using best-effort queue in OAR, and script to re-schedule best-effort jobs in case of failure. In this configuration, the best-effort job may be killed if a normal reservation is scheduled. In the same way, a best-effort job is scheduled if a resource becomes idle. </p>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 16 08:51:57 2010 for Kaapi by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
