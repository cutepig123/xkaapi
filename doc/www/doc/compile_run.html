<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>KAAPI</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
<link rel="stylesheet" type="text/css" href="info.css" media="screen" />
</head>
<body>

<div id="wrap">

<div id="header">
<h1><a href="#">KAAPI Library</a></h1>
<h2>Kernel for Adaptative, Asynchronous Parallel and Interactive programming - A library for ditributed computing</h2>
</div>

<div id="right">

<!-- SECTION !-->
<a name="compile-and-run"></a>

<p>This chapter details the basic steps needed to compile a source code linked with <code>KAAPI</code>,
and how to run it.

<ul class="menu" style="display:none;">
<li><a accesskey="1" href="compile_run.html#compile">compile</a>: Compiling Athapascan program
<li><a accesskey="2" href="compile_run.html#run">run</a>: Running Athapascan program
</ul>

<div class="node">
<a name="compile"></a>

</div>

<h3 class="section">3.1 Compiling Athapascan program</h3>

<p>Once <code>KAAPI</code> is installed (see <a href="install.html#install-guide">install guide</a>), there are two ways to compile an <code>Athapascan</code> program. 
You can either use the help of the pkg-config program if you have it installed or
you can use environment variables.

<ul class="menu" style="display:none;">
<li><a accesskey="1" href="compile_run.html#setting-environment">setting environment</a>:  if <code>KAAPI</code> is not installed in default location
<li><a accesskey="2" href="compile_run.html#compile-with-pkg_002dconfig">compile with pkg-config</a>:  the modern way
<li><a accesskey="3" href="compile_run.html#compile-with-environment-variables">compile with environment variables</a>:  the old way
</ul>

<div class="node">
<a name="setting-environment"></a>

</div>

<h4 class="subsection">3.1.1 Setting up an environment to compile Athapascan programs</h4>

<p>If you use environment variables or if KAAPI is not installed in system
directories (usually if you did not use the &ldquo;&ndash;prefix=/usr&ldquo; with the configure
script), you need to setup your environment.

   <p>You can either start a new shell
<pre class="example">     $ $HOME/kaapi/bin/kaapish --mode=devel --flags
     $ # replace $HOME/kaapi by the prefix used with the configure script
</pre>
   <p>or you can add environment variables in the current shell
<pre class="example">     $ eval `$HOME/kaapi/bin/kaapish --shell --mode=devel --flags`
     $ # replace $HOME/kaapi by the prefix used with the configure script
</pre>
   <p>In the latter case (adding to the current environment), you can add
the line in your shell rc file (<samp><span class="file">.bashrc</span></samp>, <samp><span class="file">.tcshrc</span></samp>, ...) to avoid to
type it each time.

   <p>If <samp><span class="command">kaapish</span></samp> does not correctly detect your kind of shell, you can specify it
<pre class="example">     $ eval `$HOME/kaapi/bin/kaapish --shell=sh --mode=devel --flags`
     $ # replace $HOME/kaapi by the prefix used with the configure script
</pre>
   <p>More detail about the <samp><span class="command">kaapish</span></samp> command can be found in its man page kaapish(1)

<div class="node">
<a name="compile-with-pkg-config"></a>
<a name="compile-with-pkg_002dconfig"></a>

</div>

<h4 class="subsection">3.1.2 Using the pkg-config tool</h4>

<p>Once you setup an correct environment or if you installed KAAPI in system
directories (usually if you use the <samp><span class="option">--prefix=/usr</span></samp> with the configure script),
you can compile and link with the correct flags by requesting them to
<samp><span class="command">pkg-config</span></samp> as for any other library managed by <samp><span class="command">pkg-config</span></samp>:
<pre class="example">     $ g++ -c atha_test.cpp `pkg-config --cflags kaapi` # compiling step
     $ g++ -o atha_test atha_test.o `pkg-config --libs kaapi` # linking step
</pre>
   <div class="node">
<a name="compile-with-environment-variables"></a>

</div>

<h4 class="subsection">3.1.3 Using environment variables</h4>

<p>Once you setup an correct environment, you can compile and link with the
correct flags by using the new defined environment variables:
<pre class="example">     $ g++ -c atha_test.cpp $ATHAPASCAN1_CPPFLAGS # compiling step
     $ g++ -o atha_test atha_test.o $ATHAPASCAN1_LDFLAGS # linking step
</pre>
   <div class="node">
<a name="run"></a>

</div>

<h3 class="section">3.2 Running an Athapascan program</h3>

<p>If you have not installed KAAPI in a system-wide location, you will need to use
kaapish(1) (or karun(1) to run on several machines, see below) so that environment variables are
correctly defined.

<ul class="menu" style="display:none;">
<li><a accesskey="1" href="compile_run.html#single-instance">single instance</a>:  run program on a single computer
<li><a accesskey="2" href="compile_run.html#multiple-instance">multiple instance</a>:  run program on cluster
</ul>

<div class="node">
<a name="single-instance"></a>

</div>

<h4 class="subsection">3.2.1 Running a single instance of the program</h4>

<p>You can run the program directly:
<pre class="example">     $ $HOME/kaapi/bin/kaapish ./atha_test
     $ # replace $HOME/kaapi by the prefix used with the configure script
</pre>
   <p>Or you can update environment variables in your shell to be able to run your
program:
<pre class="example">     $ eval `$HOME/kaapi/bin/kaapish --shell --mode=run`
     $ # replace $HOME/kaapi by the prefix used with the configure script
     $ ./atha_test
</pre>
   <p><strong>NOTE</strong>: in case you already setup an environment to compile KAAPI program or
if you installed KAAPI in system directories (usually if you use the
<samp><span class="option">--prefix=/usr</span></samp> with the configure script), you already have a correct
environment to run Athapascan programs. So you can run it immediately (the last
line of the previous example)

   <p>Of cause, you can use a more featured program, for example <samp><span class="command">fibo_apiatha</span></samp>
(in this example, no running environment is previously setup, so <samp><span class="command">kaapish</span></samp> is
used)
<pre class="example">     $ $HOME/kaapi/bin/kaapish ./fibo_apiatha 30 15
                               #30: the 30-th fibonacci number
                               #15: threshold to stop recursive
</pre>
   <p><strong>NOTE</strong>: self documentation of KAAPI is displayed by the command line argument
<samp><span class="option">--help</span></samp>.  All KAAPI script or program compiled with KAAPI accept this option.

   <p>For instance:
<pre class="example">     $ $HOME/kaapi/bin/kaapish --help
     $ $HOME/kaapi/bin/kaapish ./fibo_apiatha --help
</pre>
   <p>One particular option is <samp><span class="option">--dumprc</span></samp> in order to dump default value of
properties into the file <samp><span class="file">dump.rc</span></samp> in order to change them for next run. KAAPI
looks for a properties' file named <samp><span class="file">kaapi.rc</span></samp> in <samp><span class="env">$HOME</span></samp> and <samp><span class="env">$PWD</span></samp>.

<div class="node">
<a name="multiple-instance"></a>

</div>

<h4 class="subsection">3.2.2 Running multiple instances of the program on several machines</h4>

<p>To run the same program on several machines, the user may use the <samp><span class="command">karun</span></samp>
command:

<pre class="example">     $ $HOME/kaapi/bin/karun --np &lt;#processes&gt; -f &lt;hostnames&gt; ./fibo_apiatha 30 15
</pre>
   <p>Note that if <samp><span class="command">kaapish</span></samp> is not in you <samp><span class="env">$PATH</span></samp> when executing an <samp><span class="command">ssh</span></samp> on remote
machines (check with <code>ssh &lt;machine&gt; which kaapish</code>), you will need to specify
it to <samp><span class="command">karun</span></samp>:
<pre class="example">     $ $HOME/kaapi/bin/karun --wrapper-binary kaapish=/path/on/remote/node/kaapish \
         --np &lt;#processes&gt; -f &lt;hostnames&gt; ./fibo_apiatha 30 15
</pre>
   <p>more detail about this command can be found in the man page karun(1)

   <p><strong>NOTE</strong>: if you want to run your programm on a single machine but still want to
use several threads, you can use:
<pre class="example">     $ $HOME/kaapi/bin/kaapish ./myprog --community -thread.poolsize n my args
                                     # n is the number of threads
</pre>
   <!--  -->
<div class="node">
<a name="Athapascan"></a>

</div>


</div>

<div id="left">
<h2>Navigation</h2>
<ul>
<li><a href="http://kaapi.gforge.inria.fr">Home Page</a></li>
<li><a href="http://kaapi.gforge.inria.fr/doc/index.html">Documentation</a>
<!-- DOCS !-->
    <ul>
        <li><a href="install.html">Installation Guide</a></li>
        <li><a href="compile_run.html">Compile and Run instructions</a></li>
        <li><a href="atha.html">Athapascan Overview</a></li>
        <li><a href="tuto.html">Tutorials</a></li>
        <li><a href="api.html">API</a></li>
        <li><a href="annotated.html">Doxygen documentation</a></li>
    </ul>

</li>

<li><a href="http://kaapi.gforge.inria.fr/download.html">Download</a></li>
<li><a href="http://gforge.inria.fr/projects/kaapi">GForge</a></li>
</ul>

</div>

<div id="clear">
<a href="http://www.inria.fr"><img src="INRIA-75x55.png" alt="INRIA" style="float:left;"/></a> <a href="http://lig.imag.fr"><img src="LIG-75x55.png" alt="LIG" style="float:left;" /></a>
 </div>

<div id="footer">
serge guelton | Design by <a href="http://www.minimalistic-design.net">Minimalistic Design</a>
</div>

<!-- If needed, change the copyright block at the bottom. In general, -->
<!-- all pages on the GNU web server should have the section about    -->
<!-- verbatim copying.  Please do NOT remove this without talking     -->
<!-- with the webmasters first. --> 
<!-- Please make sure the copyright date is consistent with the document -->
<!-- and that it is like this "2001, 2002" not this "2001-2002." -->
</div><!-- for id="content", starts in the include above -->
<!--#include virtual="/server/footer-min.html" -->
</div>
</body>
</html>
